#!/usr/bin/env python
#
#

""" run multiple bot instances in 1 program. """

## bootstrap

import warnings
warnings.simplefilter("ignore")

import os, sys, logging
sys.path.insert(0, os.getcwd())

from gozerlib.version import getversion

## basic imports

import logging
import time

## options parser

from gozerlib.utils.opts import makefleetopts

opts = makefleetopts()

## loglevel

from gozerlib.utils.log import setloglevel
setloglevel(opts.loglevel or "warning")
logging.warn(getversion('FLEET'))

## gozerlib imports

from gozerlib.datadir import makedirs
from gozerlib.boot import boot
from gozerlib.utils.log import setloglevel
from gozerlib.utils.mainloop import mainloop
from gozerlib.users import users_boot
import gozerlib

## start the fleet

boot(opts.datadir)

if opts.owner:
    users = users_boot()
    users.make_owner(opts.owner)

from gozerlib.fleet import getfleet
fleet = getfleet(opts.datadir)
if not fleet.avail(): logging.error("fleet - no bots found.") ; os._exit(1)
if opts.all:
    print "available fleet bots: %s" % fleet.avail()
    os._exit(0)

fleet.loadall(opts.args)

if opts.doresume:
    fleet.resume(opts.doresume)
    os.unlink(opts.doresume)
else: fleet.startall()

mainloop()
