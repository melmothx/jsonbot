#!/usr/bin/env python
#
#

""" run multiple bot instances in 1 program. """

## bootstrap

import warnings
warnings.simplefilter("ignore")

import os, sys, logging
sys.path.insert(0, os.getcwd())

from gozerlib.utils.generic import getversion
print getversion('FLEET')

## gozerlib imports

from gozerlib.datadir import makedirs
from gozerlib.boot import boot
from gozerlib.utils.log import setloglevel
from gozerlib.fleet import fleet
from gozerlib.utils.mainloop import mainloop
from gozerlib.utils.opts import makeopts, makeconfig
from gozerlib.users import users_boot
import gozerlib

## basic imports

import logging
import time

## options parser

opts = makeopts()

if opts.loglevel:
    setloglevel(opts.loglevel)
else:
    setloglevel("warning")

if opts.all:
    print "available fleet bots: %s" % fleet.avail()
    os._exit(0)

if opts.datadir:
    import gozerlib
    gozerlib.datadir.datadir = opts.datadir
    makedirs(opts.datadir)
else:
    makedirs()

## start the fleet

boot()

if opts.owner:
    users = users_boot()
    users.make_owner(opts.owner)

fleet.loadall(opts.args)

if opts.doresume:
    fleet.resume(opts.doresume)
    os.unlink(opts.doresume)
else: fleet.startall()

mainloop()
