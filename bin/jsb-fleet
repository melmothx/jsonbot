#!/usr/bin/env python
#
#

## bootstrap

import warnings
warnings.simplefilter("ignore")

import os, sys
sys.path.insert(0, os.getcwd())

from gozerlib.utils.generic import getversion
print getversion('FLEET')

## gozerlib impors

from gozerlib.datadir import makedirs
from gozerlib.boot import boot
from gozerlib.utils.log import setloglevel
from gozerlib.fleet import fleet
from gozerlib.utils.mainloop import mainloop

import gozerlib

## basic imports

import logging
import time

## options parser

if True:
    from optparse import OptionParser
    parser = OptionParser(usage='usage: %prog [options]', version='%prog ' + getversion())
    parser.add_option('-l', '--loglevel', type='string', default=False,
dest='loglevel', 
                  help="loglevel of the bot .. the lower the more it logs")
    parser.add_option('-r', '--resume', type='string', default=False, dest='doresume',
                  metavar='PATH',
                  help="resume the bot from the folder specified")

    opts, args = parser.parse_args()
    opts.args = args

if opts.loglevel:
    setloglevel(opts.loglevel)

makedirs()
boot()

from gozerlib.plugins import plugs
plugs.loadall()

fleet.loadall()
if opts.doresume:
    fleet.resume(opts.doresume)
    os.unlink(opts.doresume) # bye

fleet.startall()
mainloop()
