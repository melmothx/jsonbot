#!/usr/bin/env python
#
#

""" upload all instances in ~/jsonreg/ """

## gozerlib imports

import os, sys
sys.path.append(os.getcwd())

from gozerlib.utils.popen import gozerpopen
from gozerlib.utils.opts import makeopts
from gozerlib.datadir import getdatadir
## basic imports

from subprocess import Popen, PIPE
import os
import sys


## options parser

opts = makeopts()

ddir = opts.datadir or getdatadir()
homedir = os.path.expanduser("~")
target = opts.args or os.listdir(homedir + os.sep + 'jsonregs')
## upload all instances in ~/jsonregs/

for item in target:
    print "UPLOADING %s" % item
    execlist = ['jsb-release', item]
    print execlist
    proc = Popen(execlist)
    proc.wait()
    execstring = '%s/google_appengine/appcfg.py update %s%sreleases%s%s' % (homedir, ddir, os.sep, os.sep, item)
    proc = Popen(execstring.split())
    proc.wait()